<!DOCTYPE html>



  


<html class="theme-next muse use-motion" lang="">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.2" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Hexo, NexT" />








  <link rel="shortcut icon" type="image/x-icon" href="/images/favicon.ico?v=5.1.2" />






<meta name="description" content="Security &amp; Android &amp; Java">
<meta property="og:type" content="website">
<meta property="og:title" content="Fitz.Lee">
<meta property="og:url" content="https://fitzlee.github.io/page/4/index.html">
<meta property="og:site_name" content="Fitz.Lee">
<meta property="og:description" content="Security &amp; Android &amp; Java">
<meta property="og:locale" content="default">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Fitz.Lee">
<meta name="twitter:description" content="Security &amp; Android &amp; Java">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    sidebar: {"position":"left","display":"post","offset":12,"offset_float":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: 'Author'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="https://fitzlee.github.io/page/4/"/>





  <title>Fitz.Lee</title>
  














</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="default">

  
  
    
  

  <div class="container sidebar-position-left 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Fitz.Lee</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            Categories
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            Archives
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            Tags
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/resume/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            About
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br />
            
            Search
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off"
             placeholder="Searching..." spellcheck="false"
             type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://fitzlee.github.io/posts/android_security_signature_v1_v2.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Fitz.Lee">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Fitz.Lee">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/posts/android_security_signature_v1_v2.html" itemprop="url">Android签名机制解析v1/v2及渠道打包应用</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-02-03T00:00:00+00:00">
                2018-02-03
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/11Android-Security/" itemprop="url" rel="index">
                    <span itemprop="name">11Android_Security</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>签名机制<br><a href="https://source.android.com/security/apksigning/" target="_blank" rel="noopener">https://source.android.com/security/apksigning/</a><br><a href="http://zzqhost.com/2017/06/17/Android%E7%AD%BE%E5%90%8D%E5%8E%9F%E7%90%86%E5%89%96%E6%9E%90/" target="_blank" rel="noopener">http://zzqhost.com/2017/06/17/Android%E7%AD%BE%E5%90%8D%E5%8E%9F%E7%90%86%E5%89%96%E6%9E%90/</a></p>
<p>V1签名机制<br><a href="https://blog.csdn.net/asmcvc/article/details/9311827" target="_blank" rel="noopener">https://blog.csdn.net/asmcvc/article/details/9311827</a><br><a href="https://blog.csdn.net/asmcvc/article/details/9312021" target="_blank" rel="noopener">https://blog.csdn.net/asmcvc/article/details/9312021</a><br><a href="https://www.cnblogs.com/plokmju/p/8482993.html" target="_blank" rel="noopener">https://www.cnblogs.com/plokmju/p/8482993.html</a><br><a href="https://cloud.tencent.com/developer/article/1006237" target="_blank" rel="noopener">https://cloud.tencent.com/developer/article/1006237</a></p>
<p>V1签名机制比较简单，主要设计三个文件，分别是自签名的证书CERT.RSA， MANIFEST.MF和CERT.SF，首先对每一个文件进行sha1并进行base64编码，生成MANIFEST.MF文件，然后对MANIFEST.MF这个文件进行sha1和base64，然后对MANIFEST.MF每一个条目进行sha1和base64，其中CERT.RSA包含签名者公钥，是一种pkcs7,p7b的格式，可以直接在windows改名字就可以看到了。校验也比较简单，首先校验CERT.RSA中的自签名证书，然后校验CERT.SF，证明文件MANIFEST.MF是正确的，然后对每一个文件进行校验，看是否被篡改，就结束。那么这里有天生的缺陷，没有对META-INF下的其他文件进行校验，也没有对ZIP包其他字段进行校验，那么可以利用 Zip 格式的特点，修改Comment Length和File Comment两个字段，不会对ZIP文件造成破坏，比如写个渠道信息。</p>
<p>V1签名机制存在的问题<br>Apk包在安装的时候，是按照从(3)到(1)的顺序依次校验的，先用公钥还原签名信息，然后和.SF文件中的信息比对，然后用同样的摘要算法对.MF文件里面的每一个条目计算对应的摘要信息，然后比对.MF文件是否一致。</p>
<p>在这个过程中，我们发现有两点：</p>
<p>(1) 在校验的过程中需要解压，因为.MF文件的摘要信息是基于原始未压缩文件内容，因此在校验的时候就需要解压出原始数据，而这个解压操作无疑是耗时操作。</p>
<p>(2) apk包的完整性校验不够强。这里可以看到如果我们在apk签名后，如果对apk包中没有涉及到原始文件内容的数据块做改变那么这层校验机制就会失效（如直接通过二进制改变apk包的无关数据块如核心中央目录注释字段写一些无关注释，然后用zipalign工具对齐，则apk包还是可以正常安装的，这样就绕过了v1层的校验机制）</p>
<p>V2签名机制<br><a href="https://tech.meituan.com/android-apk-v2-signature-scheme.html" target="_blank" rel="noopener">https://tech.meituan.com/android-apk-v2-signature-scheme.html</a></p>
<p>V2签名机制，是一种增强的ZIP包签名机制，先分析下格式如下<br>整个APK（ZIP文件格式）会被分为以下四个区块：<br>Contents of ZIP entries（from offset 0 until the start of APK Signing Block）<br>APK Signing Block<br>ZIP Central Directory<br>ZIP End of Central Directory<br>那么v2签名能够对除了apk signing block以外的所有部分进行校验，如果有问题，那么就不能安装apk，相对v1来说更为安全。Apk signing block字段是可以进行更改的，不受签名约束，这部分格式如下，可以通过在id-value中多添加一些信息对，而不会改变apk的签名信息，以此实现渠道信息的添加。<br>@+0    8    这个Block的长度（本字段的长度不计算在内）<br>@+8    n    一组ID-value<br>@-24    8    这个Block的长度（和第一个字段一样值）<br>@-16    16    魔数 “APK Sig Block 42”</p>
<p>多渠道打包：<br><a href="https://www.jianshu.com/p/332525b09a88" target="_blank" rel="noopener">https://www.jianshu.com/p/332525b09a88</a><br><a href="http://zzqhost.com/2017/06/18/Android%E6%89%93%E6%B8%A0%E9%81%93%E5%8C%85%E6%96%B9%E6%A1%88%E6%80%BB%E7%BB%93/" target="_blank" rel="noopener">http://zzqhost.com/2017/06/18/Android%E6%89%93%E6%B8%A0%E9%81%93%E5%8C%85%E6%96%B9%E6%A1%88%E6%80%BB%E7%BB%93/</a><br><a href="http://yifeiyuan.me/2017/01/16/muitl-channel-pkg-compare/" target="_blank" rel="noopener">http://yifeiyuan.me/2017/01/16/muitl-channel-pkg-compare/</a><br><a href="https://github.com/GavinCT/AndroidMultiChannelBuildTool" target="_blank" rel="noopener">https://github.com/GavinCT/AndroidMultiChannelBuildTool</a>  zip渠道打包  v1 META-INF<br><a href="https://github.com/mcxiaoke/packer-ng-plugin" target="_blank" rel="noopener">https://github.com/mcxiaoke/packer-ng-plugin</a>   packer v1 v2<br><a href="https://github.com/Meituan-Dianping/walle" target="_blank" rel="noopener">https://github.com/Meituan-Dianping/walle</a> walle  v2签名</p>
<p>多渠道打包的方案，也是基于v1和v2签名的一些固有特性来进行的。主要有code/manifest硬编码，productFlavors, zip meta-inf， zip comment注释， v2 apk signing block修改的几种方式。</p>
<p>Flavors<br>在AndroidManifest.xml中配置一个meta-data：</p>
<p><meta-data android:name="UMENG_CHANNEL" android:value="${CHANNEL_NAME}"><br>然后在app/build.gradle里配置productFlavors：</meta-data></p>
<p>productFlavors {<br>    def path = “channels.txt”<br>    file(path).eachLine { channel -&gt;<br>        “$channel” {<br>            manifestPlaceholders = [CHANNEL_NAME: channel]<br>        }<br>    }<br>}<br>PS：channels.txt 是渠道列表文件，每一行代表一个渠道，这样方便管理。<br>打包方法<br>使用 ./gradlew assembleRelease命令，就可以打出多渠道的包了。</p>
<p>原理<br>该种方式的打包原理是利用了 Gradle 的flavors功能来实现的，渠道的获取是通过如下代码方式获取。<br>ApplicationInfo appInfo = cxt.getPackageManager().getApplicationInfo(cxt.getPackageName(), PackageManager.GET_META_DATA);<br>String channel = String.valueOf(appInfo.metaData.get(“UMENG_CHANNEL”));<br>优缺点<br>优点：<br>简单，易懂，没什么门槛，也不需要依赖其他工具与插件。<br>Gradle强大的flavor功能，可以实现不同渠道拥有不同的代码实现，可以给渠道做定制包。<br>扩展性强大，没有兼容性问题。<br>缺点：<br>打包速度极慢，因为每个渠道包都是从“0到1”，渠道一多，打包时间以小时为单位。<br>PS：我们 App 几百个渠道，用这种方式打包需要2多个小时，怎么受得了？。</p>
<p>所以，该方式适合渠道不多的时候使用，或者不同渠道需要使用不同的代码。</p>
<p>Wiki</p>
<p><a href="https://ctf-wiki.github.io/ctf-wiki/" target="_blank" rel="noopener">https://ctf-wiki.github.io/ctf-wiki/</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://fitzlee.github.io/posts/java_web_front_end_analysis.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Fitz.Lee">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Fitz.Lee">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/posts/java_web_front_end_analysis.html" itemprop="url">web前端主流框架简单解析</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-01-29T00:00:00+00:00">
                2018-01-29
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/12Java-web/" itemprop="url" rel="index">
                    <span itemprop="name">12Java_web</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>#Angular<br><a href="http://www.runoob.com/angularjs/angularjs-tutorial.html" target="_blank" rel="noopener">http://www.runoob.com/angularjs/angularjs-tutorial.html</a></p>
<p>#React<br><a href="http://www.runoob.com/react/react-tutorial.html" target="_blank" rel="noopener">http://www.runoob.com/react/react-tutorial.html</a></p>
<p>#Vue<br><a href="http://www.runoob.com/vue2/vue-tutorial.html" target="_blank" rel="noopener">http://www.runoob.com/vue2/vue-tutorial.html</a></p>
<p>#Amaze ui</p>
<p>#Bootstrap<br><a href="http://www.runoob.com/bootstrap/bootstrap-tutorial.html" target="_blank" rel="noopener">http://www.runoob.com/bootstrap/bootstrap-tutorial.html</a></p>
<h1 id="zheng-admin-ui"><a href="#zheng-admin-ui" class="headerlink" title="zheng admin ui"></a>zheng admin ui</h1>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://fitzlee.github.io/posts/java_web_framework_library_analysis.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Fitz.Lee">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Fitz.Lee">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/posts/java_web_framework_library_analysis.html" itemprop="url">Java web主流框架简单解析</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-01-20T00:00:00+00:00">
                2018-01-20
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/12Java-web/" itemprop="url" rel="index">
                    <span itemprop="name">12Java_web</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          <h2 id="springmvc-mybatis"><a href="#springmvc-mybatis" class="headerlink" title="springmvc mybatis"></a>springmvc mybatis</h2><p><a href="https://github.com/liyifeng1994/ssm" target="_blank" rel="noopener">https://github.com/liyifeng1994/ssm</a></p>
<h2 id="dubbo-zoopkeeper"><a href="#dubbo-zoopkeeper" class="headerlink" title="dubbo zoopkeeper"></a>dubbo zoopkeeper</h2><p><a href="http://www.cnblogs.com/c9999/p/6019307.html" target="_blank" rel="noopener">http://www.cnblogs.com/c9999/p/6019307.html</a><br><a href="http://blog.csdn.net/congcong68/article/details/41113239" target="_blank" rel="noopener">http://blog.csdn.net/congcong68/article/details/41113239</a></p>
<h2 id="mongo-db"><a href="#mongo-db" class="headerlink" title="mongo db"></a>mongo db</h2><p><a href="http://www.runoob.com/mongodb/nosql.html" target="_blank" rel="noopener">http://www.runoob.com/mongodb/nosql.html</a><br><a href="http://blog.csdn.net/congcong68/article/details/44277469" target="_blank" rel="noopener">http://blog.csdn.net/congcong68/article/details/44277469</a><br><a href="http://blog.csdn.net/congcong68/article/details/44545253" target="_blank" rel="noopener">http://blog.csdn.net/congcong68/article/details/44545253</a></p>
<h2 id="ehcache-redis-memcached"><a href="#ehcache-redis-memcached" class="headerlink" title="ehcache redis memcached"></a>ehcache redis memcached</h2><p><a href="http://calvin1978.blogcn.com/articles/lru.html" target="_blank" rel="noopener">http://calvin1978.blogcn.com/articles/lru.html</a></p>
<h2 id="RabbitMq、ActiveMq、ZeroMq、kafka"><a href="#RabbitMq、ActiveMq、ZeroMq、kafka" class="headerlink" title="RabbitMq、ActiveMq、ZeroMq、kafka"></a>RabbitMq、ActiveMq、ZeroMq、kafka</h2><p><a href="http://blog.csdn.net/linsongbin1/article/details/47781187" target="_blank" rel="noopener">http://blog.csdn.net/linsongbin1/article/details/47781187</a> </p>
<h3 id="Activemq"><a href="#Activemq" class="headerlink" title="Activemq"></a>Activemq</h3><p><a href="http://blog.csdn.net/jiuqiyuliang/article/details/48758203" target="_blank" rel="noopener">http://blog.csdn.net/jiuqiyuliang/article/details/48758203</a><br><a href="http://www.cnblogs.com/jaycekon/p/ActiveMq.html" target="_blank" rel="noopener">http://www.cnblogs.com/jaycekon/p/ActiveMq.html</a></p>
          <!--noindex-->
          <div class="post-button text-center">
            <a class="btn" href="/posts/java_web_framework_library_analysis.html#more" rel="contents">
              Read more &raquo;
            </a>
          </div>
          <!--/noindex-->
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://fitzlee.github.io/posts/books_recommand_data_analysis_ai_deeplearn.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Fitz.Lee">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Fitz.Lee">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/posts/books_recommand_data_analysis_ai_deeplearn.html" itemprop="url">数据获取分析与机器学习</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-01-03T00:00:00+00:00">
                2018-01-03
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/000书籍推荐/" itemprop="url" rel="index">
                    <span itemprop="name">000书籍推荐</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://fitzlee.github.io/posts/android_review_security_permissions.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Fitz.Lee">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Fitz.Lee">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/posts/android_review_security_permissions.html" itemprop="url">Android查缺补漏-安全权限</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-10-22T00:00:00+00:00">
                2017-10-22
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/21Android-review/" itemprop="url" rel="index">
                    <span itemprop="name">21Android_review</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="Binder实现原理"><a href="#Binder实现原理" class="headerlink" title="Binder实现原理"></a>Binder实现原理</h2><p><strong>用法总结：</strong><br><a href="http://gityuan.com/2015/11/22/binder-use/" target="_blank" rel="noopener">http://gityuan.com/2015/11/22/binder-use/</a><br><a href="http://gityuan.com/2015/11/23/binder-aidl/" target="_blank" rel="noopener">http://gityuan.com/2015/11/23/binder-aidl/</a><br>主要思路是:</p>
<ul>
<li>aidl两端：<br>服务端stub端，实现aidl接口，通过onTransact接收数据。<br>客户端proxy端，实现aidl接口，通过mRemote.transact传送数据。</li>
<li>asInterface:<br>new com.yuanhh.appbinderdemo.IRemoteService.Stub.Proxy(obj);</li>
</ul>
<p><img src="https://upload-images.jianshu.io/upload_images/11010834-2d27b1713cde4eee.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"><br><img src="https://upload-images.jianshu.io/upload_images/11010834-af22fcd4e3bf86b4.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br></pre></td><td class="code"><pre><span class="line">package com.yuanhh.appbinderdemo;</span><br><span class="line">public interface IRemoteService extends android.os.IInterface &#123;</span><br><span class="line">    /** * Local-side IPC implementation stub class. */</span><br><span class="line">    public static abstract class Stub extends android.os.Binder implements com.yuanhh.appbinderdemo.IRemoteService &#123;</span><br><span class="line">        private static final java.lang.String DESCRIPTOR = &quot;com.yuanhh.appbinderdemo.IRemoteService&quot;;</span><br><span class="line"></span><br><span class="line">        /** * Stub构造函数 */</span><br><span class="line">        public Stub() &#123;</span><br><span class="line">            this.attachInterface(this, DESCRIPTOR);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        /** * 将IBinder 转换为IRemoteService interface */</span><br><span class="line">        public static com.yuanhh.appbinderdemo.IRemoteService asInterface(android.os.IBinder obj) &#123;</span><br><span class="line">            if ((obj == null)) &#123;</span><br><span class="line">                return null;</span><br><span class="line">            &#125;</span><br><span class="line">            android.os.IInterface iin = obj.queryLocalInterface(DESCRIPTOR);</span><br><span class="line">            if (((iin != null) &amp;&amp; (iin instanceof com.yuanhh.appbinderdemo.IRemoteService))) &#123;                 return ((com.yuanhh.appbinderdemo.IRemoteService) iin);</span><br><span class="line">            &#125;</span><br><span class="line">            return new com.yuanhh.appbinderdemo.IRemoteService.Stub.Proxy(obj);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        @Override</span><br><span class="line">        public android.os.IBinder asBinder() &#123;</span><br><span class="line">            return this;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        @Override</span><br><span class="line">        public boolean onTransact(int code, android.os.Parcel data, android.os.Parcel reply, int flags) throws android.os.RemoteException &#123;</span><br><span class="line">            switch (code) &#123;</span><br><span class="line">                case INTERFACE_TRANSACTION: &#123;</span><br><span class="line">                    reply.writeString(DESCRIPTOR);</span><br><span class="line">                    return true;</span><br><span class="line">                &#125;</span><br><span class="line">                case TRANSACTION_getPid: &#123;</span><br><span class="line">                    data.enforceInterface(DESCRIPTOR);</span><br><span class="line">                    int _result = this.getPid();</span><br><span class="line">                    reply.writeNoException();</span><br><span class="line">                    reply.writeInt(_result);</span><br><span class="line">                    return true;</span><br><span class="line">                &#125;</span><br><span class="line">                case TRANSACTION_getMyData: &#123;</span><br><span class="line">                    data.enforceInterface(DESCRIPTOR);</span><br><span class="line">                    com.yuanhh.appbinderdemo.MyData _result = this.getMyData();</span><br><span class="line">                    reply.writeNoException();</span><br><span class="line">                    if ((_result != null)) &#123;                         reply.writeInt(1);</span><br><span class="line">                        _result.writeToParcel(reply, android.os.Parcelable.PARCELABLE_WRITE_RETURN_VALUE);</span><br><span class="line">                    &#125; else &#123;</span><br><span class="line">                        reply.writeInt(0);</span><br><span class="line">                    &#125;</span><br><span class="line">                    return true;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            return super.onTransact(code, data, reply, flags);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        private static class Proxy implements com.yuanhh.appbinderdemo.IRemoteService &#123;</span><br><span class="line">            private android.os.IBinder mRemote;</span><br><span class="line"></span><br><span class="line">            /** * Proxy构造函数 */</span><br><span class="line">            Proxy(android.os.IBinder remote) &#123;</span><br><span class="line">                mRemote = remote;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            @Override</span><br><span class="line">            public android.os.IBinder asBinder() &#123;</span><br><span class="line">                return mRemote;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            public java.lang.String getInterfaceDescriptor() &#123;</span><br><span class="line">                return DESCRIPTOR;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            @Override</span><br><span class="line">            public int getPid() throws android.os.RemoteException &#123;</span><br><span class="line">                android.os.Parcel _data = android.os.Parcel.obtain();</span><br><span class="line">                android.os.Parcel _reply = android.os.Parcel.obtain();</span><br><span class="line">                int _result;</span><br><span class="line">                try &#123;</span><br><span class="line">                    _data.writeInterfaceToken(DESCRIPTOR);</span><br><span class="line">                    mRemote.transact(Stub.TRANSACTION_getPid, _data, _reply, 0);</span><br><span class="line">                    _reply.readException();</span><br><span class="line">                    _result = _reply.readInt();</span><br><span class="line">                &#125; finally &#123;</span><br><span class="line">                    _reply.recycle();</span><br><span class="line">                    _data.recycle();</span><br><span class="line">                &#125;</span><br><span class="line">                return _result;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            @Override</span><br><span class="line">            public com.yuanhh.appbinderdemo.MyData getMyData() throws android.os.RemoteException &#123;</span><br><span class="line">                android.os.Parcel _data = android.os.Parcel.obtain();</span><br><span class="line">                android.os.Parcel _reply = android.os.Parcel.obtain();</span><br><span class="line">                com.yuanhh.appbinderdemo.MyData _result;</span><br><span class="line">                try &#123;</span><br><span class="line">                    _data.writeInterfaceToken(DESCRIPTOR);</span><br><span class="line">                    mRemote.transact(Stub.TRANSACTION_getMyData, _data, _reply, 0);</span><br><span class="line">                    _reply.readException();</span><br><span class="line">                    if ((0 != _reply.readInt())) &#123;                         _result = com.yuanhh.appbinderdemo.MyData.CREATOR.createFromParcel(_reply);</span><br><span class="line">                    &#125; else &#123;</span><br><span class="line">                        _result = null;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125; finally &#123;</span><br><span class="line">                    _reply.recycle();</span><br><span class="line">                    _data.recycle();</span><br><span class="line">                &#125;</span><br><span class="line">                return _result;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        static final int TRANSACTION_getPid = (android.os.IBinder.FIRST_CALL_TRANSACTION + 0);</span><br><span class="line">        static final int TRANSACTION_getMyData = (android.os.IBinder.FIRST_CALL_TRANSACTION + 1);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public int getPid() throws android.os.RemoteException;</span><br><span class="line"></span><br><span class="line">    public com.yuanhh.appbinderdemo.MyData getMyData() throws android.os.RemoteException;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p><strong>binder die处理思路</strong><br>比较简单之间直接在客户端注册相应callback即可。<br>IBinder.DeathRecipient mDeathRecipient = new IBinder.DeathRecipient()<br><a href="https://blog.csdn.net/lea_fy/article/details/52987004" target="_blank" rel="noopener">https://blog.csdn.net/lea_fy/article/details/52987004</a><br>具体机制可以参考：<br><a href="http://gityuan.com/2016/10/03/binder_linktodeath/" target="_blank" rel="noopener">http://gityuan.com/2016/10/03/binder_linktodeath/</a></p>
<h2 id="provider权限"><a href="#provider权限" class="headerlink" title="provider权限"></a>provider权限</h2><p><a href="http://blog.csdn.net/flowingflying/article/details/17412609&gt;" target="_blank" rel="noopener">http://blog.csdn.net/flowingflying/article/details/17412609&gt;</a><br><strong>全局权限</strong></p>
<provider android:name="com.xxx.ExampleProvider " android:authorities="com.xxx.provider " android:exported="true" android:readpermission="com.xxx.permission.READ" android:writepermission="com.xxx.permission.WRITE"><br><br><uses-permission android:name="com.xxx.permission.READ"><br><br><strong>uri权限</strong><br><provider android:name=".PrivProvider" android:authorities="xxx.xxx.flowingflying.propermission.PrivProvider" android:readpermission="xxx.permission.READ_CONTENTPROVIDER" android:exported="true"><br>    <path-permission android:pathprefix="/hello" android:readpermission="READ_HELLO_CONTENTPROVIDER"><br></path-permission></provider> 


<p>全局Uri granting权限传递</p>
<provider android:name=".PrivProvider" android:authorities="xxx.xxx.flowingflying.propermission.PrivProvider" android:readpermission="xxx.permission.READ_CONTENTPROVIDER" android:granturipermissions="true" android:exported="true"><br><br>Intent intent = new Intent(this,ReadProvider.class);<br>intent.setClassName(“com.example.propermissiongrant”, “com.example.propermissiongrant.MainActivity”);<br>intent.setData(Uri.parse(“content://xxx.xxx.flowingflying.propermission.PrivProvider/world/1”));<br>intent.setFlags(Intent.FLAG_GRANT_READ_URI_PERMISSION);  //传递权限<br>startActivity(intent);<br><br><strong>部分uri权限传递</strong><br><provider android:name=".PrivProvider" android:authorities="xxx.xxx.flowingflying.propermission.PrivProvider" android:readpermission="xxx.permission.READ_CONTENTPROVIDER" android:exported="true"><br>     <grant-uri-permission android:pathprefix="/hello"><br></grant-uri-permission></provider> 


<h2 id="android-exported说明"><a href="#android-exported说明" class="headerlink" title="android:exported说明"></a>android:exported说明</h2><p>Activity 是否可由其他应用的组件启动 —“true”表示可以，“false”表示不可以。若为“false”，则 Activity 只能由同一应用的组件或使用同一用户 ID 的不同应用启动。</p>
<p>默认值取决于 Activity 是否包含 Intent 过滤器。没有任何过滤器意味着 Activity 只能通过指定其确切的类名称进行调用。 这意味着 Activity 专供应用内部使用（因为其他应用不知晓其类名称）。 因此，在这种情况下，默认值为“false”。另一方面，至少存在一个过滤器意味着 Activity 专供外部使用，因此默认值为“true”。</p>
<p>该属性并非限制 Activity 对其他应用开放度的唯一手段。 您还可以利用权限来限制哪些外部实体可以调用 Activity（请参阅 permission 属性）。</p>
<p><a href="https://developer.android.com/guide/topics/manifest/activity-element.html?hl=zh-cn#exported" target="_blank" rel="noopener">https://developer.android.com/guide/topics/manifest/activity-element.html?hl=zh-cn#exported</a></p>
<h2 id="Broadcast权限"><a href="#Broadcast权限" class="headerlink" title="Broadcast权限"></a>Broadcast权限</h2><p><a href="https://www.cnblogs.com/whoislcj/p/5497409.html" target="_blank" rel="noopener">https://www.cnblogs.com/whoislcj/p/5497409.html</a><br><a href="https://blog.csdn.net/javensun/article/details/7334230" target="_blank" rel="noopener">https://blog.csdn.net/javensun/article/details/7334230</a></p>
<p><strong>在Android应用开发中，有时会遇到以下两种情况</strong></p>
<ol>
<li>一些敏感的广播并不想让第三方的应用收到 ；</li>
<li>要限制自己的Receiver接收某广播来源，避免被恶意的同样的ACTION的广播所干扰。</li>
</ol>
<p>在这些场景下就需要用到广播的权限限制。</p>
<p><strong>第一种场景： 谁有权收我的广播</strong><br>在这种情况下，可以在自己应用发广播时添加参数声明Receiver所需的权限。<br>首先，在Androidmanifest.xml中定义新的权限RECV_XXX，例如：</p>
<pre><code>1. &lt;permission android:name = &quot;com.android.permission.RECV_XXX&quot;/&gt;  
</code></pre><p>然后，在Sender app发送广播时将此权限作为参数传入，如下：</p>
<pre><code>1. sendBroadcast(&quot;com.android.XXX_ACTION&quot;, &quot;com.android.permission.RECV_XXX&quot;);  
</code></pre><p>这样做之后就使得只有具有RECV_XXX权限的Receiver才能接收此广播要接收该广播，在Receiver应用的AndroidManifest.xml中要添加对应的RECV_XXX权限。<br>例如：</p>
<pre><code>1. &lt;uses-permission android:name=&quot;com.android.permission.RECV_XXX&quot;&gt;&lt;/uses-permission&gt;  
</code></pre><p><strong>第二种场景： 谁有权给我发广播？</strong><br>在这种情况下，需要在Receiver app的<receiver> tag中声明一下Sender app应该具有的权限。<br>首先同上，在AndroidManifest.xml中定义新的权限SEND_XXX，例如：</receiver></p>
<pre><code>1. &lt;permission android:name=&quot;com.android.SEND_XXX&quot;/&gt;  
</code></pre><p>然后，在Receiver app的Androidmanifest.xml中的<receiver>tag里添加权限SEND_XXX的声明，如下：</receiver></p>
<pre><code>1. &lt;receiver android:name=&quot;.XXXReceiver&quot;   
2.           android:permission=&quot;com.android.permission.SEND_XXX&quot;&gt;   
3.     &lt;intent-filter&gt;  
4.          &lt;action android:name=&quot;com.android.XXX_ACTION&quot; /&gt;   
5.     &lt;/intent-filter&gt;  
6. &lt;/receiver&gt;  
</code></pre><p>这样一来，该Receiver便只能接收来自具有该SEND_XXX权限的应用发出的广播。<br>要发送这种广播，需要在Sender app的AndroidManifest.xml中也声明使用该权限即可，如下：</p>
<pre><code>1. &lt;uses-permission android:name=&quot;com.android.permission.SEND_XXX&quot;&gt;&lt;/uses-permission&gt;  
</code></pre><p>如此，可以用来对广播的来源与去处进行简单的控制。<br>同样，对Activity 和 ContentProvider的访问权限控制也类似。</p>
<p><strong>Protected-broadcast</strong><br>只有系统应用才能发送。<br>• Process.SYSTEM_UID<br>• Process.PHONE_UID<br>• Process.SHELL_UID<br>• Process.BLUETOOTH_UID<br>• or 0<br>• 其他应用不能发送</p>
<p>参考：<br><a href="https://crashpost.wordpress.com/2014/01/11/android-protected-broadcasts/" target="_blank" rel="noopener">https://crashpost.wordpress.com/2014/01/11/android-protected-broadcasts/</a><br><a href="http://blog.csdn.net/u013553529/article/details/78409382" target="_blank" rel="noopener">http://blog.csdn.net/u013553529/article/details/78409382</a></p>
<h2 id="Android存储"><a href="#Android存储" class="headerlink" title="Android存储"></a>Android存储</h2><p><a href="https://bboyfeiyu.gitbooks.io/android-tech-frontier/content/others/%E6%B8%85%E6%99%B0%E7%9A%84%E8%BD%AF%E4%BB%B6%E6%9E%B6%E6%9E%84/readme.html" target="_blank" rel="noopener">https://bboyfeiyu.gitbooks.io/android-tech-frontier/content/others/%E6%B8%85%E6%99%B0%E7%9A%84%E8%BD%AF%E4%BB%B6%E6%9E%B6%E6%9E%84/readme.html</a><br><a href="https://github.com/Blankj/AndroidStandardDevelop" target="_blank" rel="noopener">https://github.com/Blankj/AndroidStandardDevelop</a><br><a href="https://github.com/googlesamples/android-architecture" target="_blank" rel="noopener">https://github.com/googlesamples/android-architecture</a><br><a href="http://kernel.meizu.com/android-m-external-storage.html" target="_blank" rel="noopener">http://kernel.meizu.com/android-m-external-storage.html</a><br><a href="http://www.jcodecraeer.com/a/anzhuokaifa/androidkaifa/2013/0923/1557.html" target="_blank" rel="noopener">http://www.jcodecraeer.com/a/anzhuokaifa/androidkaifa/2013/0923/1557.html</a><br><a href="http://blog.csdn.net/liuxu0703/article/details/53897702" target="_blank" rel="noopener">http://blog.csdn.net/liuxu0703/article/details/53897702</a><br><a href="http://blog.csdn.net/qq_23940659/article/details/50639787" target="_blank" rel="noopener">http://blog.csdn.net/qq_23940659/article/details/50639787</a></p>
<p>相信很多新手对于Android的一些系统默认路径不太了解，在这里以5.1的Nexus5为例来介绍一下，希望对新手有点帮助，当然我也是新手啦。<br>Environment.getDataDirectory().getPath()=/data<br>Environment.getDownloadCacheDirectory().getPath()=/cache<br>Environment.getExternalStorageDirectory()=/storage/emulated/0    /sdcard/  /storage/self/primary   /mnt/user/0/primary<br>Environment.getRootDirectory().getPath()=/system<br>//警报的铃声<br>Environment.getExternalStoragePublicDirectory(Environment.DIRECTORY_ALARMS).getPath()=/storage/emulated/0/Alarms<br>//相机拍摄的图片和视频保存的位置<br>Environment.getExternalStoragePublicDirectory(Environment.DIRECTORY_DCIM).getPath()=/storage/emulated/0/DCIM<br>//下载文件保存的位置<br>Environment.getExternalStoragePublicDirectory(Environment.DIRECTORY_DOWNLOADS).getPath()=/storage/emulated/0/Download<br>//电影保存的位置<br>Environment.getExternalStoragePublicDirectory(Environment.DIRECTORY_MOVIES).getPath()=/storage/emulated/0/Movies<br>//音乐保存的位置<br>Environment.getExternalStoragePublicDirectory(Environment.DIRECTORY_MUSIC).getPath()=/storage/emulated/0/Music<br>//通知音保存的位置<br>Environment.getExternalStoragePublicDirectory(Environment.DIRECTORY_NOTIFICATIONS).getPath()=/storage/emulated/0/Notifications<br>//下载的图片保存的位置<br>Environment.getExternalStoragePublicDirectory(Environment.DIRECTORY_PICTURES).getPath()=/storage/emulated/0/Pictures<br>//用于保存podcast（博客）的音频文件<br>Environment.getExternalStoragePublicDirectory(Environment.DIRECTORY_PODCASTS).getPath()=/storage/emulated/0/Podcasts<br>//保存铃声的位置<br>Environment.getExternalStoragePublicDirectory(Environment.DIRECTORY_RINGTONES).getPath()=/storage/emulated/0/Ringtones</p>
</provider></uses-permission></provider>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://fitzlee.github.io/posts/source_read_list.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Fitz.Lee">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Fitz.Lee">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/posts/source_read_list.html" itemprop="url">源码阅读汇总</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-10-21T00:00:00+00:00">
                2017-10-21
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/000源码阅读/" itemprop="url" rel="index">
                    <span itemprop="name">000源码阅读</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="设计模式源码"><a href="#设计模式源码" class="headerlink" title="设计模式源码"></a>设计模式源码</h1><p><a href="http://welkinbai.coding.me/2017/06/04/design-pattern-1/#%E8%BF%99%E7%AF%87%E6%96%87%E7%AB%A0%E7%9A%84%E7%9B%AE%E7%9A%84%E6%98%AF%E4%BB%80%E4%B9%88%EF%BC%9F" target="_blank" rel="noopener">http://welkinbai.coding.me/2017/06/04/design-pattern-1/#%E8%BF%99%E7%AF%87%E6%96%87%E7%AB%A0%E7%9A%84%E7%9B%AE%E7%9A%84%E6%98%AF%E4%BB%80%E4%B9%88%EF%BC%9F</a><br><a href="http://welkinbai.coding.me/2017/01/18/anti-pattern/#%E4%B8%89%E3%80%81%E6%88%91%E8%87%AA%E5%B7%B1%E7%9A%84%E4%B8%80%E4%BA%9B%E6%80%9D%E8%80%83%E5%92%8C%E8%A1%A5%E5%85%85" target="_blank" rel="noopener">http://welkinbai.coding.me/2017/01/18/anti-pattern/#%E4%B8%89%E3%80%81%E6%88%91%E8%87%AA%E5%B7%B1%E7%9A%84%E4%B8%80%E4%BA%9B%E6%80%9D%E8%80%83%E5%92%8C%E8%A1%A5%E5%85%85</a></p>
<h3 id="三个工厂模式差异"><a href="#三个工厂模式差异" class="headerlink" title="三个工厂模式差异"></a>三个工厂模式差异</h3><p><a href="https://blog.csdn.net/lqw05/article/details/51909449" target="_blank" rel="noopener">https://blog.csdn.net/lqw05/article/details/51909449</a><br><a href="http://blog.onlycatch.com/post/%E7%AE%80%E5%8D%95%E5%B7%A5%E5%8E%82%EF%BC%8C%E5%B7%A5%E5%8E%82%E6%96%B9%E6%B3%95%EF%BC%8C%E6%8A%BD%E8%B1%A1%E5%B7%A5%E5%8E%82%E6%A8%A1%E5%BC%8F%E7%9A%84%E5%8C%BA%E5%88%AB" target="_blank" rel="noopener">http://blog.onlycatch.com/post/%E7%AE%80%E5%8D%95%E5%B7%A5%E5%8E%82%EF%BC%8C%E5%B7%A5%E5%8E%82%E6%96%B9%E6%B3%95%EF%BC%8C%E6%8A%BD%E8%B1%A1%E5%B7%A5%E5%8E%82%E6%A8%A1%E5%BC%8F%E7%9A%84%E5%8C%BA%E5%88%AB</a></p>
<h1 id="算法源码"><a href="#算法源码" class="headerlink" title="算法源码"></a>算法源码</h1><p><a href="http://welkinbai.coding.me/2017/06/15/jdk-collection/#%E5%85%B3%E7%B3%BB%E7%BB%93%E6%9E%84" target="_blank" rel="noopener">http://welkinbai.coding.me/2017/06/15/jdk-collection/#%E5%85%B3%E7%B3%BB%E7%BB%93%E6%9E%84</a><br><a href="https://blog.csdn.net/u010887744/article/category/6126950" target="_blank" rel="noopener">https://blog.csdn.net/u010887744/article/category/6126950</a></p>
<h1 id="Android-源码"><a href="#Android-源码" class="headerlink" title="Android 源码"></a>Android 源码</h1><h2 id="framework源码阅读"><a href="#framework源码阅读" class="headerlink" title="framework源码阅读"></a>framework源码阅读</h2><h2 id="android常用框架源码"><a href="#android常用框架源码" class="headerlink" title="android常用框架源码"></a>android常用框架源码</h2><h1 id="Java系列源码"><a href="#Java系列源码" class="headerlink" title="Java系列源码"></a>Java系列源码</h1><h2 id="Jdk源码"><a href="#Jdk源码" class="headerlink" title="Jdk源码"></a>Jdk源码</h2><h2 id="JavaWeb框架源码"><a href="#JavaWeb框架源码" class="headerlink" title="JavaWeb框架源码"></a>JavaWeb框架源码</h2><h2 id="JVM源码"><a href="#JVM源码" class="headerlink" title="JVM源码"></a>JVM源码</h2><h1 id="os源码"><a href="#os源码" class="headerlink" title="os源码"></a>os源码</h1><h2 id="Linux-kernel源码"><a href="#Linux-kernel源码" class="headerlink" title="Linux kernel源码"></a>Linux kernel源码</h2><h2 id="TrustZone源码"><a href="#TrustZone源码" class="headerlink" title="TrustZone源码"></a>TrustZone源码</h2>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://fitzlee.github.io/posts/android_review_frame_library.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Fitz.Lee">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Fitz.Lee">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/posts/android_review_frame_library.html" itemprop="url">Android查缺补漏-流行框架</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-10-16T00:00:00+00:00">
                2017-10-16
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/21Android-review/" itemprop="url" rel="index">
                    <span itemprop="name">21Android_review</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="Andriod流行框架速查"><a href="#Andriod流行框架速查" class="headerlink" title="Andriod流行框架速查"></a>Andriod流行框架速查</h2><p><a href="https://www.ctolib.com/cheatsheets-Android-ch.html" target="_blank" rel="noopener">https://www.ctolib.com/cheatsheets-Android-ch.html</a></p>
<h2 id="推荐-Team-可使用如下优秀轮子："><a href="#推荐-Team-可使用如下优秀轮子：" class="headerlink" title="推荐 Team 可使用如下优秀轮子："></a>推荐 Team 可使用如下优秀轮子：</h2><pre><code>• Retrofit
• RxAndroid
• OkHttp
• Glide/Fresco
• Gson/Fastjson
• EventBus/AndroidEventBus
• GreenDao
• Dagger2（选用）
• Tinker（选用）
</code></pre><p>来自 <a href="https://github.com/Blankj/AndroidStandardDevelop" target="_blank" rel="noopener">https://github.com/Blankj/AndroidStandardDevelop</a> </p>
<h2 id="缓存方案"><a href="#缓存方案" class="headerlink" title="缓存方案"></a>缓存方案</h2><h2 id="服务重试机制"><a href="#服务重试机制" class="headerlink" title="服务重试机制"></a>服务重试机制</h2><p>超时,重试,熔断,限流 n^2重试 1,2,4,6,8… 不断超时重试。<br><a href="http://wtoutiao.com/p/534r4HP.html" target="_blank" rel="noopener">http://wtoutiao.com/p/534r4HP.html</a><br><a href="http://www.sczyh30.com/posts/Microservice/circuit-breaker-pattern/" target="_blank" rel="noopener">http://www.sczyh30.com/posts/Microservice/circuit-breaker-pattern/</a><br><a href="http://www.cnblogs.com/yangecnu/p/Introduce-Circuit-Breaker-Pattern.html" target="_blank" rel="noopener">http://www.cnblogs.com/yangecnu/p/Introduce-Circuit-Breaker-Pattern.html</a></p>
<h2 id="图解Android应用的后台任务和提醒"><a href="#图解Android应用的后台任务和提醒" class="headerlink" title="图解Android应用的后台任务和提醒"></a>图解Android应用的后台任务和提醒</h2><p><a href="https://blog.csdn.net/qq284565035/article/details/51705341" target="_blank" rel="noopener">https://blog.csdn.net/qq284565035/article/details/51705341</a><br>简单来说就是：</p>
<ul>
<li>小于60s直接用handler</li>
<li>AlarmManager 休眠唤醒 精准唤醒 重复唤醒</li>
<li>JobScheduler</li>
</ul>
<h2 id="网络请求处理心路历程"><a href="#网络请求处理心路历程" class="headerlink" title="网络请求处理心路历程"></a>网络请求处理心路历程</h2><p><a href="http://www.jianshu.com/p/3141d4e46240" target="_blank" rel="noopener">http://www.jianshu.com/p/3141d4e46240</a></p>
<h2 id="StateMachine机制"><a href="#StateMachine机制" class="headerlink" title="StateMachine机制"></a>StateMachine机制</h2><p><a href="http://blog.csdn.net/maybe_windleave/article/details/9881991" target="_blank" rel="noopener">http://blog.csdn.net/maybe_windleave/article/details/9881991</a><br><a href="http://blog.csdn.net/lilian0118/article/details/21974229" target="_blank" rel="noopener">http://blog.csdn.net/lilian0118/article/details/21974229</a></p>
<h2 id="上传100M大文件"><a href="#上传100M大文件" class="headerlink" title="上传100M大文件"></a>上传100M大文件</h2><p>如果有个100M大的文件，需要上传至服务器中，而服务器form表单最大只能上传2M，可以用什么方法。<br>上传文件用的都是POST方式，POST方式对大小没什么限制。<br>回到题目，可以说假设每次真的只能上传2M，那么可能我们只能把文件截断，然后分别上传了。</p>
<ul>
<li>上传大文件，可以分块上传，与文件分块下载方法基本类似，使用RandomAcessFile来进行划分文件组装文件即可。使用Post方法上传文件。基本过程如下：<br><a href="https://blog.csdn.net/leiyaqiang/article/details/68491521" target="_blank" rel="noopener">https://blog.csdn.net/leiyaqiang/article/details/68491521</a></li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">//普通字符串数据  </span><br><span class="line">private void writeStringParams() throws Exception &#123;  </span><br><span class="line">    Set&lt;String&gt; keySet = textParams.keySet();  </span><br><span class="line">    for (Iterator&lt;String&gt; it = keySet.iterator(); it.hasNext();) &#123;  </span><br><span class="line">        String name = it.next();  </span><br><span class="line">        String value = textParams.get(name);  </span><br><span class="line">        ds.writeBytes(&quot;--&quot; + boundary + &quot;\r\n&quot;);  </span><br><span class="line">        ds.writeBytes(&quot;Content-Disposition: form-data; name=\&quot;&quot; + name  </span><br><span class="line">                + &quot;\&quot;\r\n&quot;);  </span><br><span class="line">        ds.writeBytes(&quot;\r\n&quot;);  </span><br><span class="line">        ds.writeBytes(encode(value) + &quot;\r\n&quot;);  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;  </span><br><span class="line">//文件数据  </span><br><span class="line">private void writeFileParams() throws Exception &#123;  </span><br><span class="line">    Set&lt;String&gt; keySet = fileparams.keySet();  </span><br><span class="line">    for (Iterator&lt;String&gt; it = keySet.iterator(); it.hasNext();) &#123;  </span><br><span class="line">        String name = it.next();  </span><br><span class="line">        File value = fileparams.get(name);  </span><br><span class="line">        ds.writeBytes(&quot;--&quot; + boundary + &quot;\r\n&quot;);  </span><br><span class="line">        ds.writeBytes(&quot;Content-Disposition: form-data; name=\&quot;&quot; + name  </span><br><span class="line">                + &quot;\&quot;; filename=\&quot;&quot; + encode(value.getName()) + &quot;\&quot;\r\n&quot;);  </span><br><span class="line">        ds.writeBytes(&quot;Content-Type: &quot; + getContentType(value) + &quot;\r\n&quot;);  </span><br><span class="line">        ds.writeBytes(&quot;\r\n&quot;);  </span><br><span class="line">        ds.write(getBytes(value));  </span><br><span class="line">        ds.writeBytes(&quot;\r\n&quot;);  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://fitzlee.github.io/posts/android_review_thread.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Fitz.Lee">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Fitz.Lee">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/posts/android_review_thread.html" itemprop="url">Android查缺补漏-线程</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-10-12T00:00:00+00:00">
                2017-10-12
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/21Android-review/" itemprop="url" rel="index">
                    <span itemprop="name">21Android_review</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="Android线程的几种方式"><a href="#Android线程的几种方式" class="headerlink" title="Android线程的几种方式"></a>Android线程的几种方式</h2><p>AsyncTask/HandlerThread/Thread/IntentService<br><a href="https://www.jianshu.com/p/34cffd700f75" target="_blank" rel="noopener">https://www.jianshu.com/p/34cffd700f75</a></p>
<h2 id="AsyncTask"><a href="#AsyncTask" class="headerlink" title="AsyncTask"></a>AsyncTask</h2><p>单个线程的线程池，一个一个执行，会阻塞后边线程。可以设置 AsyncTask.executeOnExecutor()来同时执行任务。写的时候注意避免内存泄露</p>
<h2 id="HandlerThread"><a href="#HandlerThread" class="headerlink" title="HandlerThread"></a>HandlerThread</h2><p>实质是一个Thread，不过添加了Looper和MessageQueue，这样就可以使用Handler来进行控制代码执行了。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">// 创建一个线程，线程名字 : handlerThreadTest</span><br><span class="line">        mHandlerThread = new HandlerThread(&quot;handlerThreadTest&quot;);</span><br><span class="line">        mHandlerThread.start();</span><br><span class="line">        </span><br><span class="line">        // Handler 接收消息</span><br><span class="line">        final Handler mHandler = new Handler(mHandlerThread.getLooper()) &#123;</span><br><span class="line">            @Override</span><br><span class="line">            public void handleMessage(Message msg) &#123;</span><br><span class="line">                Log.e(&quot;Test&quot;, &quot;收到 &quot; + msg.obj.toString() + &quot; 在 &quot;</span><br><span class="line">                        + Thread.currentThread().getName());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">        mTextView = (TextView) findViewById(R.id.text_view);</span><br><span class="line">        // 主线程发出消息</span><br><span class="line">        mTextView.setOnClickListener(new View.OnClickListener() &#123;</span><br><span class="line">            @Override</span><br><span class="line">            public void onClick(View v) &#123;</span><br><span class="line">                Message msg = new Message();</span><br><span class="line">                msg.obj = &quot;第一条信息&quot;;</span><br><span class="line">                mHandler.sendMessage(msg);</span><br><span class="line">                Log.e(&quot;Test&quot;, &quot;发出 &quot; + msg.obj.toString() + &quot; 在 &quot;</span><br><span class="line">                        + Thread.currentThread().getName());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        // 子线程发出消息</span><br><span class="line">        new Thread(new Runnable() &#123;</span><br><span class="line">            @Override</span><br><span class="line">            public void run() &#123;</span><br><span class="line">                Message msg = new Message();</span><br><span class="line">                msg.obj = &quot;第二条信息&quot;;</span><br><span class="line">                mHandler.sendMessage(msg);</span><br><span class="line">                Log.e(&quot;Test&quot;, &quot;发出 &quot; + msg.obj.toString() + &quot; 在 &quot;</span><br><span class="line">                        + Thread.currentThread().getName());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;).start()；</span><br></pre></td></tr></table></figure></p>
<p>但是最后不要忘记mHandlerThread.quit();否则将一直循环。另外可以在run方法里设置不同优先级android.os.Process.setThreadPriority(Process.THREAD_PRIORITY_BACKGROUND);同样HandlerThread的构造方法也提供了设置优先级的功能，new HandlerThread(“LightTaskThread”, Process.THREAD_PRIORITY_BACKGROUND);AsyncTask同样设置了优先级THREAD_PRIORITY_BACKGROUND。<br>HandlerThread的默认优先级是Process.THREAD_PRIORITY_DEFAULT,具体值为0。线程的优先级的取值范围为-20到19。优先级高的获得的CPU资源更多，反之则越少。-20代表优先级最高，19最低。0位于中间位置，但是作为工作线程的HandlerThread没有必要设置这么高的优先级，因而需要我们降低其优先级。<br>THREAD_PRIORITY_DEFAULT，默认的线程优先级，值为0。<br>THREAD_PRIORITY_LOWEST，最低的线程级别，值为19。<br>THREAD_PRIORITY_BACKGROUND 后台线程建议设置这个优先级，值为10。<br>THREAD_PRIORITY_MORE_FAVORABLE 相对THREAD_PRIORITY_DEFAULT稍微优先，值为-1。<br>THREAD_PRIORITY_LESS_FAVORABLE 相对THREAD_PRIORITY_DEFAULT稍微落后一些，值为1。</p>
<h2 id="IntentService"><a href="#IntentService" class="headerlink" title="IntentService"></a>IntentService</h2><p>使用了HandlerThread使得IntentService可以运行耗时任务，一般使用时结合主线程Handler或者LocalBroadCastManager来通知主界面UI的更新。</p>
<h2 id="ThreadPool线程池"><a href="#ThreadPool线程池" class="headerlink" title="ThreadPool线程池"></a>ThreadPool线程池</h2><p>线程池不允许使用 Executors 去创建，而是通过ThreadPoolExecutor 的方式，这样的处理方式让写的同学更加明确线程池的运行规则，规避资源耗尽的风险。<br>说明： Executors 返回的线程池对象的弊端如下：<br>1） FixedThreadPool 和 SingleThreadPool:<br>允许的请求队列长度为 Integer.MAX_VALUE ，可能会堆积大量的请求，从而导致 OOM 。<br>2） CachedThreadPool 和ScheduledThreadPool :<br>允许的创建线程数量为 Integer.MAX_VALUE ，可能会创建大量的线程，从而导致 OOM 。</p>
<p>ThreadPoolExecutor(<br>int corePoolSize,<br>int maximumPoolSize,<br>long keepAliveTime,<br>TimeUnit unit,<br>BlockingQueue<runnable> workQueue,<br>RejectedExecutionHandler handler<br>);</runnable></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br></pre></td><td class="code"><pre><span class="line">public class ThreadPoolTest &#123;</span><br><span class="line">    private static final int CORE_POOL_SIZE = 5;</span><br><span class="line">    private static final int MAX_POOL_SIZE = 10;</span><br><span class="line">    private static final int BLOCK_POOL_SIZE = 2;</span><br><span class="line">    private static final int ALIVE_POOL_SIZE = 2;</span><br><span class="line">    private static ThreadPoolExecutor executor;</span><br><span class="line"></span><br><span class="line">    public static void main(String args[]) &#123;</span><br><span class="line">        executor = new ThreadPoolExecutor(</span><br><span class="line">                CORE_POOL_SIZE,// 核心线程数 最小</span><br><span class="line">                MAX_POOL_SIZE,// 最大执行线程数</span><br><span class="line">                ALIVE_POOL_SIZE,// 空闲线程超时</span><br><span class="line">                TimeUnit.SECONDS,// 超时时间单位</span><br><span class="line">                // 当线程池达到corePoolSize时，新提交任务将被放入workQueue中，</span><br><span class="line">                // 等待线程池中任务调度执行</span><br><span class="line">                new ArrayBlockingQueue&lt;Runnable&gt;(BLOCK_POOL_SIZE),// 阻塞队列大小</span><br><span class="line">                // 线程工厂，为线程池提供创建新线程的功能，它是一个接口，</span><br><span class="line">                // 只有一个方法：Thread newThread(Runnable r)</span><br><span class="line">                Executors.defaultThreadFactory(),</span><br><span class="line">                // 线程池对拒绝任务的处理策略。一般是队列已满或者无法成功执行任务，</span><br><span class="line">                // 这时ThreadPoolExecutor会调用handler的rejectedExecution</span><br><span class="line">                // 方法来通知调用者</span><br><span class="line">                new ThreadPoolExecutor.AbortPolicy()</span><br><span class="line">        );</span><br><span class="line">        executor.allowCoreThreadTimeOut(true);</span><br><span class="line">        /*</span><br><span class="line">         * ThreadPoolExecutor默认有四个拒绝策略：</span><br><span class="line">         *</span><br><span class="line">         * 1、ThreadPoolExecutor.AbortPolicy()   直接抛出异常RejectedExecutionException</span><br><span class="line">         * 2、ThreadPoolExecutor.CallerRunsPolicy()    直接调用run方法并且阻塞执行</span><br><span class="line">         * 3、ThreadPoolExecutor.DiscardPolicy()   直接丢弃后来的任务</span><br><span class="line">         * 4、ThreadPoolExecutor.DiscardOldestPolicy()  丢弃在队列中队首的任务</span><br><span class="line">         */</span><br><span class="line"></span><br><span class="line">        for (int i = 0; i &lt; 10; i++) &#123;</span><br><span class="line">            try &#123;</span><br><span class="line">                executor.execute(new WorkerThread(&quot;线程 --&gt; &quot; + i));</span><br><span class="line">                LOG();</span><br><span class="line">            &#125; catch (Exception e) &#123;</span><br><span class="line">                System.out.println(&quot;AbortPolicy...&quot;);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        executor.shutdown();</span><br><span class="line"></span><br><span class="line">        // 所有任务执行完毕后再次打印日志</span><br><span class="line">        new Thread(new Runnable() &#123;</span><br><span class="line">            @Override</span><br><span class="line">            public void run() &#123;</span><br><span class="line">                try &#123;</span><br><span class="line">                    Thread.sleep(1000);</span><br><span class="line">                    System.out.println(&quot;\n\n---------执行完毕---------\n&quot;);</span><br><span class="line">                    LOG();</span><br><span class="line">                &#125; catch (Exception e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;).start();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 打印 Log 信息</span><br><span class="line">     */</span><br><span class="line">    private static void LOG() &#123;</span><br><span class="line">        System.out.println(&quot; ==============线程池===============\n&quot;</span><br><span class="line">                + &quot;   线程池中线程数 : &quot; + executor.getPoolSize()</span><br><span class="line">                + &quot;   等待执行线程数 : &quot; + executor.getQueue().size()</span><br><span class="line">                + &quot;   所有的任务数 : &quot; + executor.getTaskCount()</span><br><span class="line">                + &quot;   执行任务的线程数 : &quot; + executor.getActiveCount()</span><br><span class="line">                + &quot;   执行完毕的任务数 : &quot; + executor.getCompletedTaskCount()</span><br><span class="line"></span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // 模拟线程任务</span><br><span class="line">    public static class WorkerThread implements Runnable &#123;</span><br><span class="line">        private String threadName;</span><br><span class="line"></span><br><span class="line">        public WorkerThread(String threadName) &#123;</span><br><span class="line">            this.threadName = threadName;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        @Override</span><br><span class="line">        public synchronized void run() &#123;</span><br><span class="line"></span><br><span class="line">            int i = 0;</span><br><span class="line">            boolean flag = true;</span><br><span class="line">            try &#123;</span><br><span class="line">                while (flag) &#123;</span><br><span class="line">                    i++;</span><br><span class="line">                    if (i &gt; 2) flag = false;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; catch (Exception e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        public String getThreadName() &#123;</span><br><span class="line">            return threadName;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="请解释下在单线程模型中Message-Handler-Message-Queue-Looper之间的关系。"><a href="#请解释下在单线程模型中Message-Handler-Message-Queue-Looper之间的关系。" class="headerlink" title="请解释下在单线程模型中Message,Handler,Message Queue,Looper之间的关系。"></a>请解释下在单线程模型中Message,Handler,Message Queue,Looper之间的关系。</h2><p>拿主线程来说，主线程启动时会调用Looper.prepare()方法，会初始化一个Looper，放入Threadlocal中，接着调用Looper.loop()不断遍历Message Queue，Handler的创建依赖与当前线程中的Looper，如果当前线程没有Looper则必须调用Looper.prepare()。Handler , sendMessage到MessageQueue，Looper不断从MessageQueue中取出消息，回调handleMessage方法。 </p>
<ul>
<li>Looper  Message Queue 和 Handler， HandlerThread源码<br><a href="https://blog.csdn.net/lovedren/article/details/51701477" target="_blank" rel="noopener">https://blog.csdn.net/lovedren/article/details/51701477</a><br><a href="https://blog.csdn.net/charles674611395/article/details/51914659" target="_blank" rel="noopener">https://blog.csdn.net/charles674611395/article/details/51914659</a></li>
</ul>
<h2 id="Android的进程间通信，Liunx操作系统的进程间通信"><a href="#Android的进程间通信，Liunx操作系统的进程间通信" class="headerlink" title="Android的进程间通信，Liunx操作系统的进程间通信"></a>Android的进程间通信，Liunx操作系统的进程间通信</h2><p>binder(所有android上层几乎都是binder)/socket(zygote-systemserver)<br>Linux机制： 管道、消息队列、共享内存、套接字、信号量、信号这些IPC机制<br>handler线程之间通信</p>
<h2 id="asynctask的原理"><a href="#asynctask的原理" class="headerlink" title="asynctask的原理"></a>asynctask的原理</h2><p>AsyncTask是对Thread和Handler的组合包装。<br><a href="https://blog.csdn.net/iispring/article/details/50670388" target="_blank" rel="noopener">https://blog.csdn.net/iispring/article/details/50670388</a><br><a href="https://blog.csdn.net/epubit17/article/details/80342004" target="_blank" rel="noopener">https://blog.csdn.net/epubit17/article/details/80342004</a></p>
<h2 id="Alarm机制"><a href="#Alarm机制" class="headerlink" title="Alarm机制"></a>Alarm机制</h2><p>Timer TimerTask<br><a href="http://coderlin.coding.me/2016/04/02/Android-%E5%88%9D%E6%AD%A5%E4%B9%8BTimmer-AlarmManager-JobSchedule/&gt;" target="_blank" rel="noopener">http://coderlin.coding.me/2016/04/02/Android-%E5%88%9D%E6%AD%A5%E4%B9%8BTimmer-AlarmManager-JobSchedule/&gt;</a></p>
<h2 id="JobScheduler"><a href="#JobScheduler" class="headerlink" title="JobScheduler"></a>JobScheduler</h2><p><a href="http://blog.csdn.net/bboyfeiyu/article/details/44809395" target="_blank" rel="noopener">http://blog.csdn.net/bboyfeiyu/article/details/44809395</a></p>
<h2 id="ELAPSED-REALTIME-WAKEUP和RTC-WAKEUP的区别"><a href="#ELAPSED-REALTIME-WAKEUP和RTC-WAKEUP的区别" class="headerlink" title="ELAPSED_REALTIME_WAKEUP和RTC_WAKEUP的区别"></a>ELAPSED_REALTIME_WAKEUP和RTC_WAKEUP的区别</h2><p>AlarmManager.ELAPSED_REALTIME_WAKEUP type is used to trigger the alarm since boot time:<br>alarmManager.set(AlarmManager.ELAPSED_REALTIME_WAKEUP, 600000, pendingIntent);<br>will actually make the alarm go off 10 min after the device boots.<br>There is a timer that starts running when the device boots up to measure the uptime of the device and this is the type that triggers your alarm according to the uptime of the device.<br>Whereas, AlarmManager.RTC_WAKEUP will trigger the alarm according to the time of the clock. For example if you do:<br>long thirtySecondsFromNow = System.currentTimeMillis() + 30 * 1000;<br>alarmManager.set(AlarmManager.RTC_WAKEUP, thirtySecondsFromNow , pendingIntent);<br>this, on the other hand, will trigger the alarm 30 seconds from now.<br>AlarmManager.ELAPSED_REALTIME_WAKEUP type is rarely used compared to AlarmManager.RTC_WAKEUP</p>
<p>来自 <a href="http://stackoverflow.com/questions/5938213/android-alarmmanager-rtc-wakeup-vs-elapsed-realtime-wakeup" target="_blank" rel="noopener">http://stackoverflow.com/questions/5938213/android-alarmmanager-rtc-wakeup-vs-elapsed-realtime-wakeup</a> </p>
<h2 id="handler和timer的延迟对比"><a href="#handler和timer的延迟对比" class="headerlink" title="handler和timer的延迟对比"></a>handler和timer的延迟对比</h2><p>Handler vs Timer<br>在我们Android开发过程中，经常需要执行一些短周期的定时任务，这时候有两个选择Timer或者Handler。然而个人认为：Handler在多个方面比Timer更为优秀，更推荐使用。<br>一.易用性</p>
<ol>
<li>可重复执行<br> • Handler可以重复执行某个任务。<br> • Timer若在某个任务执行/取消之后，再次执行则会抛出一个IllegalStateException异常。为了避免这个异常，需要重新创建一个Timer对象。</li>
<li>周期可调整<br>若想要执行一个越来越快的定时任务，Handler可以做到，而Timer则消耗较大。<br> • Handler<br>private Handler handler = new Handler();<br>int mDelayTime = 1000;<br>private Runnable runnable = new Runnable() {<br>public void run() {<br>   update();<br>   if （mDelayTime &gt; 0） {<pre><code>handler.postDelayed(this,mDelayTime); 
mDelayTime -= 100;
</code></pre>   }<br>}<br>};<br>handler.postDelayed(runnable,1000);<br>如以上例子，就可以实现对周期的动态调整。<br> • Timer的scheduleAtFixedRate(TimerTask task, long delay, long period)只能执行固定周期的任务，所以不可以动态地调整周期。若想要动态调整，则需要在执行玩一个定时器任务后，再启动一个新的任务时设置新的时间。</li>
<li>UI界面更新<br> • Handler：在创建的时候可以指定所在的线程，一般在Activity中构建的，即主线程上，所以可以在回调方法中很方便的更新界面。<br> • Timer：异步回调，所以必须借助Handler去更新界面，不方便。<br>既然都得用Handler去更新界面了，为何不如把定时的功能也交给Handler去做呢？<br>二.内存占比<br>Timer比Handler更占内存。<br>接下来的Demo例子通过两种方法循环地打印日志，然后通过MAT插件来查看这两个类所需要调用的对象所产生的占比。</li>
</ol>
<h2 id="Async转sync的方法-异步-gt-同步"><a href="#Async转sync的方法-异步-gt-同步" class="headerlink" title="Async转sync的方法 异步-&gt;同步"></a>Async转sync的方法 异步-&gt;同步</h2><p>You could do this with CountdownLatch, which might be the lightest synchronization primitive in java.util.concurrent:<br>private boolean findPrinter(final Context ctx) {<br>    final CountdownLatch latch = new CountdownLatch(1);<br>    final boolean[] result = {false};<br>…<br>BluetoothDiscoverer.findPrinters(ctx, new DiscoveryHandler() {<br>…<br>public void discoveryFinished() {<br>            result[0] = true;<br>            latch.countDown();<br>        }<br>public void discoveryError(String arg0) {<br>            result[0] = false;<br>            latch.countDown();<br>        }<br>…<br>    }<br>// before final return<br>    // wait for 10 seconds for the response<br>    latch.await(10, TimeUnit.SECONDS);<br>//return the result, it will return false when there is timeout<br>    return result[0];<br>}<br>来自 <a href="https://stackoverflow.com/questions/20659961/java-synchronous-callback" target="_blank" rel="noopener">https://stackoverflow.com/questions/20659961/java-synchronous-callback</a> </p>
<h2 id="Handler集中形式原理"><a href="#Handler集中形式原理" class="headerlink" title="Handler集中形式原理"></a>Handler集中形式原理</h2><p><a href="https://blog.csdn.net/reakingf/article/details/52054598" target="_blank" rel="noopener">https://blog.csdn.net/reakingf/article/details/52054598</a><br><strong>Looper</strong><br>其中threadlocal保证一个线程只有一个Looper<br>一个Looper一个MessageQueue<br>不断循环获取msg，从target中取得相应得handler来进行dispatchmsg<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">private static void prepare(boolean quitAllowed) &#123;</span><br><span class="line">    if (sThreadLocal.get() != null) &#123;</span><br><span class="line">        throw new RuntimeException(&quot;Only one Looper may be created per thread&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">    sThreadLocal.set(new Looper(quitAllowed));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">private Looper(boolean quitAllowed) &#123;</span><br><span class="line">    mQueue = new MessageQueue(quitAllowed);</span><br><span class="line">    mThread = Thread.currentThread();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">public static void loop() &#123;</span><br><span class="line">    for (;;) &#123;</span><br><span class="line">            Message msg = queue.next(); // might block</span><br><span class="line">            msg.target.dispatchMessage(msg);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p><strong>处理顺序Handler.dispatchMessage</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">public void dispatchMessage(Message msg) &#123;</span><br><span class="line">    if (msg.callback != null) &#123;</span><br><span class="line">        handleCallback(msg);</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        if (mCallback != null) &#123;</span><br><span class="line">            if (mCallback.handleMessage(msg)) &#123;</span><br><span class="line">                return;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        handleMessage(msg);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p><strong>msg</strong></p>
<ul>
<li><p>sendEmptyMessageDelayed(what, time)-&gt;sendMessageAtTime<br>msg.what = what</p>
</li>
<li><p>postAtTime(Runnable r, long uptimeMillis)<br>sendMessageDelayed(getPostMessage(r), 0);<br>getPostMessage()<br>m.callback = r</p>
</li>
<li><p>enqueue msg<br>msg.target = 记录不同handler</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">private boolean enqueueMessage(MessageQueue queue, Message msg, long uptimeMillis) &#123;</span><br><span class="line">    msg.target = this;</span><br><span class="line">    if (mAsynchronous) &#123;</span><br><span class="line">        msg.setAsynchronous(true);</span><br><span class="line">    &#125;</span><br><span class="line">    return queue.enqueueMessage(msg, uptimeMillis);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p><strong>hanlder</strong><br>Handler(Handler.Callback callback)</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://fitzlee.github.io/posts/android_security_cs_book_recommand.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Fitz.Lee">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Fitz.Lee">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/posts/android_security_cs_book_recommand.html" itemprop="url">计算机系统安全书籍推荐</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-10-07T00:00:00+00:00">
                2017-10-07
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/11Android-Security/" itemprop="url" rel="index">
                    <span itemprop="name">11Android_Security</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>#书籍学习<br>外话：用书和文档镇楼，站在巨人的肩膀上，才能进步的更快，才能少踩坑，赶紧阅读吧少年们。</p>
<p>#Linux内核<br>ORANGE’S：一个操作系统的实现<br>Linux内核设计与实现_第三版<br>Linux内核设计的艺术<br>Linux内核完全注释V3.0书签版<br>30天自制操作系统.川合秀实</p>
<p>#系统安全原理篇<br>计算机安全原理与实践<br>黑客攻防技术宝典.系统实战篇.第二版.pdf<br>黑客之道：漏洞发的艺术.Jon.Erickson.扫描版<br>黑客调试技术揭密.美.Kaspersky.扫描版.pdf<br>0day安全：软件漏洞分析技术（第2版）<br>Shellcoder编程揭秘<br>老码识途 从机器码到框架的系统观逆向修炼之路</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://fitzlee.github.io/posts/android_security_white_paper.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Fitz.Lee">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Fitz.Lee">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/posts/android_security_white_paper.html" itemprop="url">Android安全白皮书</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-10-06T00:00:00+00:00">
                2017-10-06
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/11Android-Security/" itemprop="url" rel="index">
                    <span itemprop="name">11Android_Security</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="安全"><a href="#安全" class="headerlink" title="安全"></a>安全</h1><p>安全是相对于攻击来说的，一定程序上避免了恶意攻击就可以说是安全的。那么安全级别如何得以尽可能的增强，防止99%作恶的人的攻击破解，提高安全感？</p>
<h2 id="Android应用安全"><a href="#Android应用安全" class="headerlink" title="Android应用安全"></a>Android应用安全</h2><ul>
<li><p>Android应用安全<br>安全要点checklist<br><a href="https://source.android.google.cn/security/overview/app-security" target="_blank" rel="noopener">https://source.android.google.cn/security/overview/app-security</a><br><a href="https://developer.android.com/training/articles/security-tips?hl=zh-cn#top_of_page" target="_blank" rel="noopener">https://developer.android.com/training/articles/security-tips?hl=zh-cn#top_of_page</a></p>
</li>
<li><p>Android安全与逆向<br><a href="http://www.520monkey.com/archives/category/%E5%AE%89%E5%85%A8%E5%92%8C%E9%80%86%E5%90%91/page/8" target="_blank" rel="noopener">http://www.520monkey.com/archives/category/%E5%AE%89%E5%85%A8%E5%92%8C%E9%80%86%E5%90%91/page/8</a></p>
</li>
</ul>
<h2 id="Android系统安全"><a href="#Android系统安全" class="headerlink" title="Android系统安全"></a>Android系统安全</h2><p>Linux 安全<br>基于用户的权限模式<br>文件系统权限<br>安全增强型 Linux<br>验证启动<br>加密算法库 KeyChain/KeyStore/JCA/BC/BoringSSL/KeyMaster/TEE<br>用户安全功能<br>身份验证<br>生物识别解锁<br>TrustZone-TEE<br>InSE芯片系统</p>
<h2 id="安全产品"><a href="#安全产品" class="headerlink" title="安全产品"></a>安全产品</h2><p>设备证书，IFFA/FIDO<br>签名机制<br>病毒查杀</p>
<h2 id="安全协议"><a href="#安全协议" class="headerlink" title="安全协议"></a>安全协议</h2><p>从我们身边常见的安全<br>区块链<br>口令认证<br>Oauth<br>手机解锁屏<br>指纹</p>
<h2 id="安全攻防"><a href="#安全攻防" class="headerlink" title="安全攻防"></a>安全攻防</h2><p>Wifi破解<br>wifi入侵<br>服务器入侵<br>无线攻击<br>经典CVE漏洞收集<br>CVE-2017-8890<br><a href="http://www.freebuf.com/articles/terminal/160041.html" target="_blank" rel="noopener">http://www.freebuf.com/articles/terminal/160041.html</a><br>经典病毒查找，确认系统安全性<br>发布伪造APK，获取流量或用户点击<br>社会工程学</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/3/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/3/">3</a><span class="page-number current">4</span><a class="page-number" href="/page/5/">5</a><span class="space">&hellip;</span><a class="page-number" href="/page/10/">10</a><a class="extend next" rel="next" href="/page/5/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel sidebar-panel-active">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/avatar.gif"
               alt="Fitz.Lee" />
          <p class="site-author-name" itemprop="name">Fitz.Lee</p>
           
              <p class="site-description motion-element" itemprop="description">Security & Android & Java</p>
          
        </div>
        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
              <a href="/archives/">
                <span class="site-state-item-count">91</span>
                <span class="site-state-item-name">posts</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-categories">
              <a href="/categories/index.html">
                <span class="site-state-item-count">12</span>
                <span class="site-state-item-name">categories</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-tags">
              <a href="/tags/index.html">
                <span class="site-state-item-count">144</span>
                <span class="site-state-item-name">tags</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/fitzlee" target="_blank" title="GitHub">
                  
                    <i class="fa fa-fw fa-github"></i>
                  
                    
                      GitHub
                    
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="mailto:fitz.lee@outlook.com" target="_blank" title="E-Mail">
                  
                    <i class="fa fa-fw fa-envelope"></i>
                  
                    
                      E-Mail
                    
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="https://www.jianshu.com/u/c7757daadf27" target="_blank" title="JianShu">
                  
                    <i class="fa fa-fw fa-book"></i>
                  
                    
                      JianShu
                    
                </a>
              </span>
            
          
        </div>

        
        

        
        
          <div class="links-of-blogroll motion-element links-of-blogroll-inline">
            <div class="links-of-blogroll-title">
              <i class="fa  fa-fw fa-globe"></i>
              Links
            </div>
            <ul class="links-of-blogroll-list">
              
                <li class="links-of-blogroll-item">
                  <a href="https://www.anquanke.com/" title="Anquanke" target="_blank">Anquanke</a>
                </li>
              
                <li class="links-of-blogroll-item">
                  <a href="https://www.gityuan.com/" title="Gityuan" target="_blank">Gityuan</a>
                </li>
              
            </ul>
          </div>
        

        


      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Fitz.Lee</span>
</div>


<div class="powered-by">
  Powered by <a class="theme-link" href="https://hexo.io">Hexo</a>
</div>

<div class="theme-info">
  Theme -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Muse
  </a>
</div>


        

        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.2"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.2"></script>



  
  

  
    <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.2"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.2"></script>

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.2"></script>



  


  




	





  





  






  

  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  

  

  

  

  

</body>
</html>
